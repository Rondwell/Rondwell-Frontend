<script lang="ts">
	
	import { page } from '$app/stores';
	import {
	showSubMenu,
	subMenuItems,
	activeSubItem,
	showSettingsSubMenu,
	settingsSubMenuItems,
	activeSettingsItem

} from '$lib/stores/uiStore';

	import { get } from 'svelte/store';
	

	
	const collectionIcon = {
		eventIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.9081 18.9584H6.09144C2.61644 18.9584 1.55811 17.9 1.55811 14.425V14.0417C1.55811 13.7 1.84144 13.4167 2.18311 13.4167C2.91644 13.4167 3.51644 12.8167 3.51644 12.0834C3.51644 11.35 2.91644 10.75 2.18311 10.75C1.84144 10.75 1.55811 10.4667 1.55811 10.125V9.74171C1.55811 6.26671 2.61644 5.20837 6.09144 5.20837H13.9081C17.3831 5.20837 18.4414 6.26671 18.4414 9.74171V10.525C18.4414 10.8667 18.1581 11.15 17.8164 11.15C17.0831 11.15 16.4831 11.75 16.4831 12.4834C16.4831 13.2167 17.0831 13.8084 17.8164 13.8084C18.1581 13.8084 18.4414 14.0917 18.4414 14.4334C18.4331 17.9 17.3748 18.9584 13.9081 18.9584ZM2.81644 14.5917C2.83311 17.2417 3.35811 17.7084 6.09977 17.7084H13.9164C16.5164 17.7084 17.1164 17.2834 17.1914 14.975C16.0748 14.6917 15.2414 13.6834 15.2414 12.475C15.2414 11.2667 16.0748 10.25 17.1998 9.96671V9.73337C17.1998 6.94171 16.7081 6.45004 13.9164 6.45004H6.09144C3.35811 6.45004 2.83311 6.92504 2.80811 9.56671C3.93311 9.85004 4.76644 10.8667 4.76644 12.075C4.76644 13.2834 3.93311 14.3084 2.81644 14.5917Z" fill="currentColor"/>
<path d="M8.3335 8.54171C7.99183 8.54171 7.7085 8.25837 7.7085 7.91671V5.83337C7.7085 5.49171 7.99183 5.20837 8.3335 5.20837C8.67516 5.20837 8.9585 5.49171 8.9585 5.83337V7.91671C8.9585 8.25837 8.67516 8.54171 8.3335 8.54171Z" fill="currentColor"/>
<path d="M8.3335 14.1C7.99183 14.1 7.7085 13.8166 7.7085 13.475V10.7C7.7085 10.3583 7.99183 10.075 8.3335 10.075C8.67516 10.075 8.9585 10.3583 8.9585 10.7V13.475C8.9585 13.8166 8.67516 14.1 8.3335 14.1Z" fill="currentColor"/>
<path d="M8.3335 18.9583C7.99183 18.9583 7.7085 18.675 7.7085 18.3333V16.25C7.7085 15.9083 7.99183 15.625 8.3335 15.625C8.67516 15.625 8.9585 15.9083 8.9585 16.25V18.3333C8.9585 18.675 8.67516 18.9583 8.3335 18.9583Z" fill="currentColor"/>
<path d="M13.6082 6.45828H6.03315C5.78315 6.45828 5.54982 6.30828 5.45815 6.07495C5.36649 5.84162 5.41649 5.56662 5.59149 5.39162L8.03315 2.94995C10.2832 0.699951 11.6582 0.699951 13.8998 2.94995L14.3998 3.44995C14.5165 3.56662 14.5832 3.72495 14.5832 3.89162C14.5832 4.05828 14.5165 4.21662 14.3998 4.33328C14.0665 4.66662 13.9748 5.15828 14.1665 5.58328C14.2582 5.77495 14.2415 5.99995 14.1248 6.18328C14.0165 6.34995 13.8165 6.45828 13.6082 6.45828ZM7.54149 5.20828H12.8165C12.7998 4.76662 12.9082 4.32495 13.1332 3.94162L13.0248 3.83328C11.2832 2.09162 10.6665 2.09162 8.92482 3.83328L7.54149 5.20828Z" fill="currentColor"/>
</svg>`,

		peopleIcon: `<svg width="20" height="16" viewBox="0 0 20 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.79167 0C8.06578 0 6.66667 1.55444 6.66667 3.47195C6.66667 5.38945 8.06578 6.9439 9.79167 6.9439C11.5176 6.9439 12.9167 5.38945 12.9167 3.47195C12.9167 1.55444 11.5176 0 9.79167 0ZM7.91667 3.47195C7.91667 2.32145 8.75613 1.38878 9.79167 1.38878C10.8272 1.38878 11.6667 2.32145 11.6667 3.47195C11.6667 4.62245 10.8272 5.55512 9.79167 5.55512C8.75613 5.55512 7.91667 4.62245 7.91667 3.47195Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.29167 8.33268C5.56578 8.33268 4.16667 9.88712 4.16667 11.8046C4.16667 13.7221 5.56578 15.2766 7.29167 15.2766H12.2917C14.0176 15.2766 15.4167 13.7221 15.4167 11.8046C15.4167 9.88712 14.0176 8.33268 12.2917 8.33268H7.29167ZM5.41667 11.8046C5.41667 10.6541 6.25613 9.72145 7.29167 9.72145H12.2917C13.3272 9.72145 14.1667 10.6541 14.1667 11.8046C14.1667 12.9551 13.3272 13.8878 12.2917 13.8878H7.29167C6.25613 13.8878 5.41667 12.9551 5.41667 11.8046Z" fill="currentColor"/>
<path d="M6.25178 5.91495C6.12035 5.68036 5.87372 5.55512 5.625 5.55512C4.58947 5.55512 3.75 4.62245 3.75 3.47195C3.75 2.32145 4.58947 1.38878 5.625 1.38878C5.87372 1.38878 6.12035 1.26354 6.25178 1.02894C6.2576 1.01857 6.26345 1.00822 6.26933 0.9979C6.48817 0.614125 6.37729 0.0707357 5.97083 0.0210199C5.85728 0.00712999 5.74189 0 5.625 0C3.89911 0 2.5 1.55444 2.5 3.47195C2.5 5.38945 3.89911 6.9439 5.625 6.9439C5.74189 6.9439 5.85728 6.93677 5.97084 6.92288C6.37729 6.87316 6.48817 6.32977 6.26933 5.946C6.26345 5.93568 6.2576 5.92533 6.25178 5.91495Z" fill="currentColor"/>
<path d="M3.71524 13.2553C3.62064 13.08 3.45366 12.9619 3.26966 12.9619H3.125C2.08947 12.9619 1.25 12.0293 1.25 10.8788C1.25 9.72827 2.08947 8.7956 3.125 8.7956H3.26966C3.45366 8.7956 3.62064 8.67758 3.71524 8.50223C3.94616 8.0742 3.69557 7.40682 3.24641 7.40682H3.125C1.39911 7.40682 0 8.96127 0 10.8788C0 12.7963 1.39911 14.3507 3.125 14.3507H3.24641C3.69557 14.3507 3.94616 13.6833 3.71524 13.2553Z" fill="currentColor"/>
<path d="M13.314 5.946C13.0952 6.32977 13.206 6.87316 13.6125 6.92288C13.7261 6.93677 13.8414 6.9439 13.9583 6.9439C15.6842 6.9439 17.0833 5.38945 17.0833 3.47195C17.0833 1.55444 15.6842 0 13.9583 0C13.8414 0 13.7261 0.00713003 13.6125 0.02102C13.206 0.0707359 13.0952 0.614125 13.314 0.997899C13.3199 1.00822 13.3257 1.01857 13.3315 1.02894C13.463 1.26353 13.7096 1.38878 13.9583 1.38878C14.9939 1.38878 15.8333 2.32145 15.8333 3.47195C15.8333 4.62245 14.9939 5.55512 13.9583 5.55512C13.7096 5.55512 13.463 5.68036 13.3315 5.91495C13.3257 5.92533 13.3199 5.93568 13.314 5.946Z" fill="currentColor"/>
<path d="M15.8681 13.2553C15.6372 13.6833 15.8878 14.3507 16.3369 14.3507H16.4583C18.1842 14.3507 19.5833 12.7963 19.5833 10.8788C19.5833 8.96127 18.1842 7.40682 16.4583 7.40682H16.3369C15.8878 7.40682 15.6372 8.0742 15.8681 8.50223C15.9627 8.67758 16.1297 8.7956 16.3137 8.7956H16.4583C17.4939 8.7956 18.3333 9.72827 18.3333 10.8788C18.3333 12.0293 17.4939 12.9619 16.4583 12.9619H16.3137C16.1297 12.9619 15.9627 13.08 15.8681 13.2553Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.79167 0C8.06578 0 6.66667 1.55444 6.66667 3.47195C6.66667 5.38945 8.06578 6.9439 9.79167 6.9439C11.5176 6.9439 12.9167 5.38945 12.9167 3.47195C12.9167 1.55444 11.5176 0 9.79167 0ZM7.91667 3.47195C7.91667 2.32145 8.75613 1.38878 9.79167 1.38878C10.8272 1.38878 11.6667 2.32145 11.6667 3.47195C11.6667 4.62245 10.8272 5.55512 9.79167 5.55512C8.75613 5.55512 7.91667 4.62245 7.91667 3.47195Z" stroke="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.29167 8.33268C5.56578 8.33268 4.16667 9.88712 4.16667 11.8046C4.16667 13.7221 5.56578 15.2766 7.29167 15.2766H12.2917C14.0176 15.2766 15.4167 13.7221 15.4167 11.8046C15.4167 9.88712 14.0176 8.33268 12.2917 8.33268H7.29167ZM5.41667 11.8046C5.41667 10.6541 6.25613 9.72145 7.29167 9.72145H12.2917C13.3272 9.72145 14.1667 10.6541 14.1667 11.8046C14.1667 12.9551 13.3272 13.8878 12.2917 13.8878H7.29167C6.25613 13.8878 5.41667 12.9551 5.41667 11.8046Z" stroke="currentColor"/>
<path d="M6.25178 5.91495C6.12035 5.68036 5.87372 5.55512 5.625 5.55512C4.58947 5.55512 3.75 4.62245 3.75 3.47195C3.75 2.32145 4.58947 1.38878 5.625 1.38878C5.87372 1.38878 6.12035 1.26354 6.25178 1.02894C6.2576 1.01857 6.26345 1.00822 6.26933 0.9979C6.48817 0.614125 6.37729 0.0707357 5.97083 0.0210199C5.85728 0.00712999 5.74189 0 5.625 0C3.89911 0 2.5 1.55444 2.5 3.47195C2.5 5.38945 3.89911 6.9439 5.625 6.9439C5.74189 6.9439 5.85728 6.93677 5.97084 6.92288C6.37729 6.87316 6.48817 6.32977 6.26933 5.946C6.26345 5.93568 6.2576 5.92533 6.25178 5.91495Z" stroke="currentColor"/>
<path d="M3.71524 13.2553C3.62064 13.08 3.45366 12.9619 3.26966 12.9619H3.125C2.08947 12.9619 1.25 12.0293 1.25 10.8788C1.25 9.72827 2.08947 8.7956 3.125 8.7956H3.26966C3.45366 8.7956 3.62064 8.67758 3.71524 8.50223C3.94616 8.0742 3.69557 7.40682 3.24641 7.40682H3.125C1.39911 7.40682 0 8.96127 0 10.8788C0 12.7963 1.39911 14.3507 3.125 14.3507H3.24641C3.69557 14.3507 3.94616 13.6833 3.71524 13.2553Z" stroke="currentColor"/>
<path d="M13.314 5.946C13.0952 6.32977 13.206 6.87316 13.6125 6.92288C13.7261 6.93677 13.8414 6.9439 13.9583 6.9439C15.6842 6.9439 17.0833 5.38945 17.0833 3.47195C17.0833 1.55444 15.6842 0 13.9583 0C13.8414 0 13.7261 0.00713003 13.6125 0.02102C13.206 0.0707359 13.0952 0.614125 13.314 0.997899C13.3199 1.00822 13.3257 1.01857 13.3315 1.02894C13.463 1.26353 13.7096 1.38878 13.9583 1.38878C14.9939 1.38878 15.8333 2.32145 15.8333 3.47195C15.8333 4.62245 14.9939 5.55512 13.9583 5.55512C13.7096 5.55512 13.463 5.68036 13.3315 5.91495C13.3257 5.92533 13.3199 5.93568 13.314 5.946Z" stroke="currentColor"/>
<path d="M15.8681 13.2553C15.6372 13.6833 15.8878 14.3507 16.3369 14.3507H16.4583C18.1842 14.3507 19.5833 12.7963 19.5833 10.8788C19.5833 8.96127 18.1842 7.40682 16.4583 7.40682H16.3369C15.8878 7.40682 15.6372 8.0742 15.8681 8.50223C15.9627 8.67758 16.1297 8.7956 16.3137 8.7956H16.4583C17.4939 8.7956 18.3333 9.72827 18.3333 10.8788C18.3333 12.0293 17.4939 12.9619 16.4583 12.9619H16.3137C16.1297 12.9619 15.9627 13.08 15.8681 13.2553Z" stroke="currentColor"/>
</svg>
`,

		newsletterIcon: `<svg width="20" height="23" viewBox="0 0 20 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.49951 1.65735H12.4995C14.6917 1.65735 16.1392 2.17782 17.0542 3.19446C17.9805 4.22362 18.4585 5.86615 18.4585 8.33313V13.8878C18.4585 16.3549 17.9805 17.9973 17.0542 19.0265C16.1391 20.043 14.6916 20.5636 12.4995 20.5636H7.49951C5.30771 20.5635 3.86081 20.0429 2.9458 19.0265C2.01949 17.9973 1.5415 16.3549 1.5415 13.8878V8.33313C1.5415 5.86608 2.01949 4.22361 2.9458 3.19446C3.8608 2.17792 5.30755 1.6574 7.49951 1.65735ZM7.49951 2.04602C5.53257 2.04606 4.04923 2.43125 3.0835 3.50403C2.13131 4.56193 1.7915 6.17277 1.7915 8.33313V13.8878C1.7915 16.0481 2.13137 17.658 3.0835 18.7159C4.04922 19.7889 5.53244 20.1739 7.49951 20.174H12.4995C14.4667 20.174 15.9507 19.7889 16.9165 18.7159C17.8685 17.658 18.2085 16.048 18.2085 13.8878V8.33313C18.2085 6.17277 17.8687 4.56193 16.9165 3.50403C15.9507 2.43107 14.4667 2.04602 12.4995 2.04602H7.49951Z" fill="currentColor" stroke="currentColor"/>
<path d="M13.125 9.02708H6.875C6.53333 9.02708 6.25 8.71229 6.25 8.3327C6.25 7.9531 6.53333 7.63831 6.875 7.63831H13.125C13.4667 7.63831 13.75 7.9531 13.75 8.3327C13.75 8.71229 13.4667 9.02708 13.125 9.02708Z" fill="currentColor"/>
<path d="M13.125 14.5821H6.875C6.53333 14.5821 6.25 14.2673 6.25 13.8877C6.25 13.5081 6.53333 13.1934 6.875 13.1934H13.125C13.4667 13.1934 13.75 13.5081 13.75 13.8877C13.75 14.2673 13.4667 14.5821 13.125 14.5821Z" fill="currentColor"/>
</svg>

`,

		insightIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16.6643 11.6685C17.5846 11.6685 18.3306 10.9225 18.3306 10.0022C18.3306 9.08195 17.5846 8.33594 16.6643 8.33594C15.7441 8.33594 14.998 9.08195 14.998 10.0022C14.998 10.9225 15.7441 11.6685 16.6643 11.6685Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16.6643 5.00442C17.5846 5.00442 18.3306 4.25841 18.3306 3.33815C18.3306 2.41789 17.5846 1.67188 16.6643 1.67188C15.7441 1.67188 14.998 2.41789 14.998 3.33815C14.998 4.25841 15.7441 5.00442 16.6643 5.00442Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16.6643 18.3247C17.5846 18.3247 18.3306 17.5787 18.3306 16.6585C18.3306 15.7382 17.5846 14.9922 16.6643 14.9922C15.7441 14.9922 14.998 15.7382 14.998 16.6585C14.998 17.5787 15.7441 18.3247 16.6643 18.3247Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3.33229 11.6685C4.25255 11.6685 4.99856 10.9225 4.99856 10.0022C4.99856 9.08195 4.25255 8.33594 3.33229 8.33594C2.41203 8.33594 1.66602 9.08195 1.66602 10.0022C1.66602 10.9225 2.41203 11.6685 3.33229 11.6685Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <g opacity="0.4">
    <path d="M4.99805 9.99219H14.9957" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14.996 3.32812H11.6635C9.9972 3.32812 9.16406 4.16126 9.16406 5.82754V14.1589C9.16406 15.8252 9.9972 16.6583 11.6635 16.6583H14.996" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    </g>
    </svg>`,

		settingsIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M7.49951 1.54163H12.4995C14.7046 1.54163 16.1599 2.01454 17.0728 2.92737C17.9854 3.84016 18.4584 5.29484 18.4585 7.49963V12.4996C18.4585 14.7047 17.9856 16.16 17.0728 17.0729C16.1599 17.9857 14.7046 18.4586 12.4995 18.4586H7.49951C5.29472 18.4586 3.84004 17.9856 2.92725 17.0729C2.01442 16.16 1.5415 14.7047 1.5415 12.4996V7.49963C1.54155 5.29471 2.01446 3.84015 2.92725 2.92737C3.84003 2.01458 5.29459 1.54167 7.49951 1.54163ZM7.49951 1.79163C5.54356 1.79166 4.06827 2.134 3.10107 3.1012C2.13388 4.06839 1.79154 5.54369 1.7915 7.49963V12.4996C1.7915 14.4555 2.13407 15.9308 3.10107 16.8981C4.06827 17.8653 5.54356 18.2086 7.49951 18.2086H12.4995C14.4556 18.2086 15.9307 17.8653 16.8979 16.8981C17.8652 15.9308 18.2085 14.4557 18.2085 12.4996V7.49963C18.2085 5.54369 17.8651 4.06839 16.8979 3.1012C15.9307 2.13419 14.4554 1.79163 12.4995 1.79163H7.49951Z" fill="currentColor" stroke="currentColor"/>
<path d="M12.9834 16.0416C12.6417 16.0416 12.3584 15.7583 12.3584 15.4166V12.1666C12.3584 11.825 12.6417 11.5416 12.9834 11.5416C13.3251 11.5416 13.6084 11.825 13.6084 12.1666V15.4166C13.6084 15.7583 13.3251 16.0416 12.9834 16.0416Z" fill="currentColor"/>
<path d="M12.9834 6.83337C12.6417 6.83337 12.3584 6.55004 12.3584 6.20837V4.58337C12.3584 4.24171 12.6417 3.95837 12.9834 3.95837C13.3251 3.95837 13.6084 4.24171 13.6084 4.58337V6.20837C13.6084 6.55004 13.3251 6.83337 12.9834 6.83337Z" fill="currentColor"/>
<path d="M12.9836 11.1667C11.4419 11.1667 10.1919 9.91671 10.1919 8.37504C10.1919 6.83337 11.4419 5.58337 12.9836 5.58337C14.5252 5.58337 15.7752 6.83337 15.7752 8.37504C15.7752 9.91671 14.5169 11.1667 12.9836 11.1667ZM12.9836 6.83337C12.1336 6.83337 11.4419 7.52504 11.4419 8.37504C11.4419 9.22504 12.1336 9.91671 12.9836 9.91671C13.8336 9.91671 14.5252 9.22504 14.5252 8.37504C14.5252 7.52504 13.8252 6.83337 12.9836 6.83337Z" fill="currentColor"/>
<path d="M7.0166 16.0416C6.67493 16.0416 6.3916 15.7583 6.3916 15.4166V13.7916C6.3916 13.45 6.67493 13.1666 7.0166 13.1666C7.35827 13.1666 7.6416 13.45 7.6416 13.7916V15.4166C7.6416 15.7583 7.3666 16.0416 7.0166 16.0416Z" fill="currentColor"/>
<path d="M7.0166 8.45837C6.67493 8.45837 6.3916 8.17504 6.3916 7.83337V4.58337C6.3916 4.24171 6.67493 3.95837 7.0166 3.95837C7.35827 3.95837 7.6416 4.24171 7.6416 4.58337V7.83337C7.6416 8.17504 7.3666 8.45837 7.0166 8.45837Z" fill="currentColor"/>
<path d="M7.01676 14.4167C5.4751 14.4167 4.2251 13.1667 4.2251 11.625C4.2251 10.0834 5.4751 8.83337 7.01676 8.83337C8.55843 8.83337 9.80843 10.0834 9.80843 11.625C9.80843 13.1667 8.55843 14.4167 7.01676 14.4167ZM7.01676 10.0834C6.16676 10.0834 5.4751 10.775 5.4751 11.625C5.4751 12.475 6.16676 13.1667 7.01676 13.1667C7.86676 13.1667 8.55843 12.475 8.55843 11.625C8.55843 10.775 7.8751 10.0834 7.01676 10.0834Z" fill="currentColor"/>
</svg>`
	};

	function updateCollectionSubMenu(collectionId: string) {
		subMenuItems.set([
			{
				label: 'Events',
				icon: collectionIcon.eventIcon,
				nav: `/collection/${collectionId}`
			},
			{
				label: 'People',
				icon: collectionIcon.peopleIcon,
				nav: `/collection/${collectionId}/people`
			},
			{
				label: 'Newsletter',
				icon: collectionIcon.newsletterIcon,
				nav: `/collection/${collectionId}/newsletter`
			},
			{
				label: 'Insight',
				icon: collectionIcon.insightIcon,
				nav: `/collection/${collectionId}/insight`
			},
			{
				label: 'Settings',
				icon: collectionIcon.settingsIcon,
				nav: `/collection/${collectionId}/settings`
			}
		]);
	}

	function updateSettingsSubMenu(collectionId: string) {
	settingsSubMenuItems.set([
		{ label: 'Display',
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings` },
		{ label: 'Payment', 
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/payment` },
		{ label: 'Options',
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/options` },
		{ label: 'Admins', 
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/admins` },
		{ label: 'Tags',
		icon: collectionIcon.eventIcon, 
		 nav: `/collection/${collectionId}/settings/tags` },
		{ label: 'Embed',
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/embed` },
		{ label: 'Send limit',
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/send-limit` },
		{ label: 'Rondwell Plus',
		icon: collectionIcon.eventIcon, nav: `/collection/${collectionId}/settings/plus` }

	]);
}


	$: {
	const path = $page.url.pathname;

	const collectionMatch = path.match(/^\/collection\/([^/]+)/);

	if (collectionMatch) {
		const collectionId = collectionMatch[1];

		// ---- Level 1 submenu (Events, People, Settings...)
		updateCollectionSubMenu(collectionId);
		const currentMenu = get(subMenuItems);
		const active = currentMenu.find((item) => path.startsWith(item.nav))?.label || 'Events';
		activeSubItem.set(active);
		showSubMenu.set(true);

		// ---- Level 2 submenu (ONLY when in settings)
		if (path.startsWith(`/collection/${collectionId}/settings`)) {
			updateSettingsSubMenu(collectionId);
			showSettingsSubMenu.set(true);
			// goto(`/collection/${collectionId}/settings/display`, { replaceState: true });

			const settingsMenu = get(settingsSubMenuItems);
			const activeSettings =
				settingsMenu.find((item) => path.startsWith(item.nav))?.label || 'Display';

			activeSettingsItem.set(activeSettings);


		} else {
			showSettingsSubMenu.set(false);
			settingsSubMenuItems.set([]);
			activeSettingsItem.set('');
		}

	} else {
		// Outside collection routes
		showSubMenu.set(false);
		subMenuItems.set([]);
		activeSubItem.set('');

		showSettingsSubMenu.set(false);
		settingsSubMenuItems.set([]);
		activeSettingsItem.set('');
	}
}

</script>

<slot />
