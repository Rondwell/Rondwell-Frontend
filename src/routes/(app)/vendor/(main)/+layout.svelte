<script lang="ts">
	import { browser } from '$app/environment';
	import { page } from '$app/stores';
	import { onMount } from 'svelte';
	import { get } from 'svelte/store';

	import Sidebar from '../../components/Sidebar.svelte';
	import SideMenu from '../../components/SideMenu.svelte';

	import { showSubMenu, subMenuItems, activeSubItem } from '$lib/stores/uiStore.js';

	const vendorIcons = {
		overviewIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M13.3333 18.9583H6.66667C1.875 18.9583 1.875 16.4167 1.875 14.1667V13.3333C1.875 11.475 1.875 9.375 5.83333 9.375C6.825 9.375 7.19167 9.61667 7.70833 10C7.73333 10.025 7.76667 10.0417 7.79167 10.075L8.64167 10.975C9.35833 11.7333 10.6583 11.7333 11.375 10.975L12.225 10.075C12.25 10.05 12.275 10.025 12.3083 10C12.825 9.60833 13.1917 9.375 14.1833 9.375C18.1417 9.375 18.1417 11.475 18.1417 13.3333V14.1667C18.125 17.35 16.5167 18.9583 13.3333 18.9583ZM5.83333 10.625C3.125 10.625 3.125 11.475 3.125 13.3333V14.1667C3.125 16.45 3.125 17.7083 6.66667 17.7083H13.3333C15.8167 17.7083 16.875 16.65 16.875 14.1667V13.3333C16.875 11.475 16.875 10.625 14.1667 10.625C13.5667 10.625 13.4417 10.7 13.0833 10.9667L12.275 11.825C11.675 12.4583 10.8667 12.8083 10 12.8083C9.13333 12.8083 8.325 12.4583 7.725 11.825L6.91667 10.9667C6.55833 10.7 6.43333 10.625 5.83333 10.625Z" fill="currentColor"/>
    <path d="M15.8327 10.6224C15.491 10.6224 15.2077 10.3391 15.2077 9.9974V4.9974C15.2077 3.13906 15.2077 2.28906 12.4993 2.28906H7.49935C4.79102 2.28906 4.79102 3.13906 4.79102 4.9974V9.9974C4.79102 10.3391 4.50768 10.6224 4.16602 10.6224C3.82435 10.6224 3.54102 10.3391 3.54102 9.9974V4.9974C3.54102 3.13906 3.54102 1.03906 7.49935 1.03906H12.4993C16.4577 1.03906 16.4577 3.13906 16.4577 4.9974V9.9974C16.4577 10.3391 16.1743 10.6224 15.8327 10.6224Z" fill="currentColor"/>
    <path d="M11.566 8.32031H8.79102C8.44935 8.32031 8.16602 8.03698 8.16602 7.69531C8.16602 7.35365 8.44935 7.07031 8.79102 7.07031H11.566C11.9077 7.07031 12.191 7.35365 12.191 7.69531C12.191 8.03698 11.916 8.32031 11.566 8.32031Z" fill="currentColor"/>
    <path d="M12.2663 5.82031H8.09961C7.75794 5.82031 7.47461 5.53698 7.47461 5.19531C7.47461 4.85365 7.75794 4.57031 8.09961 4.57031H12.2663C12.6079 4.57031 12.8913 4.85365 12.8913 5.19531C12.8913 5.53698 12.6163 5.82031 12.2663 5.82031Z" fill="currentColor"/>
    </svg>`,

		productsIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M12.4993 18.9557H7.49935C2.97435 18.9557 1.04102 17.0224 1.04102 12.4974V7.4974C1.04102 2.9724 2.97435 1.03906 7.49935 1.03906H12.4993C17.0243 1.03906 18.9577 2.9724 18.9577 7.4974V12.4974C18.9577 17.0224 17.0243 18.9557 12.4993 18.9557ZM7.49935 2.28906C3.65768 2.28906 2.29102 3.65573 2.29102 7.4974V12.4974C2.29102 16.3391 3.65768 17.7057 7.49935 17.7057H12.4993C16.341 17.7057 17.7077 16.3391 17.7077 12.4974V7.4974C17.7077 3.65573 16.341 2.28906 12.4993 2.28906H7.49935Z" fill="currentColor"/>
    <path d="M12.9824 16.0391C12.6408 16.0391 12.3574 15.7557 12.3574 15.4141V12.1641C12.3574 11.8224 12.6408 11.5391 12.9824 11.5391C13.3241 11.5391 13.6074 11.8224 13.6074 12.1641V15.4141C13.6074 15.7557 13.3241 16.0391 12.9824 16.0391Z" fill="currentColor"/>
    <path d="M12.9824 6.83594C12.6408 6.83594 12.3574 6.5526 12.3574 6.21094V4.58594C12.3574 4.24427 12.6408 3.96094 12.9824 3.96094C13.3241 3.96094 13.6074 4.24427 13.6074 4.58594V6.21094C13.6074 6.5526 13.3241 6.83594 12.9824 6.83594Z" fill="currentColor"/>
    <path d="M12.9831 11.1693C11.4414 11.1693 10.1914 9.91927 10.1914 8.3776C10.1914 6.83594 11.4414 5.58594 12.9831 5.58594C14.5247 5.58594 15.7747 6.83594 15.7747 8.3776C15.7747 9.91927 14.5164 11.1693 12.9831 11.1693ZM12.9831 6.83594C12.1331 6.83594 11.4414 7.5276 11.4414 8.3776C11.4414 9.2276 12.1331 9.91927 12.9831 9.91927C13.8331 9.91927 14.5247 9.2276 14.5247 8.3776C14.5247 7.5276 13.8247 6.83594 12.9831 6.83594Z" fill="currentColor"/>
    <path d="M7.01758 16.0391C6.67591 16.0391 6.39258 15.7557 6.39258 15.4141V13.7891C6.39258 13.4474 6.67591 13.1641 7.01758 13.1641C7.35924 13.1641 7.64258 13.4474 7.64258 13.7891V15.4141C7.64258 15.7557 7.36758 16.0391 7.01758 16.0391Z" fill="currentColor"/>
    <path d="M7.01758 8.46094C6.67591 8.46094 6.39258 8.1776 6.39258 7.83594V4.58594C6.39258 4.24427 6.67591 3.96094 7.01758 3.96094C7.35924 3.96094 7.64258 4.24427 7.64258 4.58594V7.83594C7.64258 8.1776 7.36758 8.46094 7.01758 8.46094Z" fill="currentColor"/>
    <path d="M7.01628 14.4193C5.47461 14.4193 4.22461 13.1693 4.22461 11.6276C4.22461 10.0859 5.47461 8.83594 7.01628 8.83594C8.55794 8.83594 9.80794 10.0859 9.80794 11.6276C9.80794 13.1693 8.55794 14.4193 7.01628 14.4193ZM7.01628 10.0859C6.16628 10.0859 5.47461 10.7776 5.47461 11.6276C5.47461 12.4776 6.16628 13.1693 7.01628 13.1693C7.86628 13.1693 8.55794 12.4776 8.55794 11.6276C8.55794 10.7776 7.87461 10.0859 7.01628 10.0859Z" fill="currentColor"/>
    </svg>`,

		collabIcon: `<svg width="20" height="23" viewBox="0 0 20 23" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.9987 3.70312C8.27281 3.70312 6.8737 5.25757 6.8737 7.17507C6.8737 9.09258 8.27281 10.647 9.9987 10.647C11.7246 10.647 13.1237 9.09258 13.1237 7.17507C13.1237 5.25757 11.7246 3.70312 9.9987 3.70312ZM8.1237 7.17507C8.1237 6.02457 8.96316 5.0919 9.9987 5.0919C11.0342 5.0919 11.8737 6.02457 11.8737 7.17507C11.8737 8.32558 11.0342 9.25824 9.9987 9.25824C8.96316 9.25824 8.1237 8.32558 8.1237 7.17507Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.4987 12.0358C5.77281 12.0358 4.3737 13.5902 4.3737 15.5077C4.3737 17.4253 5.77281 18.9797 7.4987 18.9797H12.4987C14.2246 18.9797 15.6237 17.4253 15.6237 15.5077C15.6237 13.5902 14.2246 12.0358 12.4987 12.0358H7.4987ZM5.6237 15.5077C5.6237 14.3572 6.46316 13.4246 7.4987 13.4246H12.4987C13.5342 13.4246 14.3737 14.3572 14.3737 15.5077C14.3737 16.6583 13.5342 17.5909 12.4987 17.5909H7.4987C6.46316 17.5909 5.6237 16.6583 5.6237 15.5077Z" fill="currentColor"/>
<path d="M6.45882 9.61808C6.32738 9.38348 6.08075 9.25824 5.83203 9.25824C4.7965 9.25824 3.95703 8.32558 3.95703 7.17507C3.95703 6.02457 4.7965 5.0919 5.83203 5.0919C6.08075 5.0919 6.32738 4.96666 6.45882 4.73207C6.46463 4.72169 6.47048 4.71135 6.47636 4.70102C6.6952 4.31725 6.58432 3.77386 6.17787 3.72414C6.06431 3.71025 5.94892 3.70312 5.83203 3.70312C4.10614 3.70312 2.70703 5.25757 2.70703 7.17507C2.70703 9.09258 4.10614 10.647 5.83203 10.647C5.94892 10.647 6.06431 10.6399 6.17787 10.626C6.58432 10.5763 6.6952 10.0329 6.47636 9.64912C6.47048 9.6388 6.46463 9.62845 6.45882 9.61808Z" fill="currentColor"/>
<path d="M3.92227 16.9584C3.82767 16.7831 3.66069 16.6651 3.47669 16.6651H3.33203C2.2965 16.6651 1.45703 15.7324 1.45703 14.5819C1.45703 13.4314 2.2965 12.4987 3.33203 12.4987H3.47669C3.66069 12.4987 3.82767 12.3807 3.92227 12.2054C4.15319 11.7773 3.9026 11.1099 3.45344 11.1099H3.33203C1.60614 11.1099 0.207031 12.6644 0.207031 14.5819C0.207031 16.4994 1.60614 18.0538 3.33203 18.0538H3.45344C3.9026 18.0538 4.15319 17.3865 3.92227 16.9584Z" fill="currentColor"/>
<path d="M13.521 9.64912C13.3022 10.0329 13.4131 10.5763 13.8195 10.626C13.9331 10.6399 14.0485 10.647 14.1654 10.647C15.8913 10.647 17.2904 9.09258 17.2904 7.17507C17.2904 5.25757 15.8913 3.70312 14.1654 3.70312C14.0485 3.70312 13.9331 3.71026 13.8195 3.72414C13.4131 3.77386 13.3022 4.31725 13.521 4.70102C13.5269 4.71134 13.5328 4.72169 13.5386 4.73207C13.67 4.96666 13.9166 5.0919 14.1654 5.0919C15.2009 5.0919 16.0404 6.02457 16.0404 7.17507C16.0404 8.32558 15.2009 9.25824 14.1654 9.25824C13.9166 9.25824 13.67 9.38348 13.5386 9.61808C13.5328 9.62845 13.5269 9.6388 13.521 9.64912Z" fill="currentColor"/>
<path d="M16.0751 16.9584C15.8442 17.3865 16.0948 18.0538 16.544 18.0538H16.6654C18.3913 18.0538 19.7904 16.4994 19.7904 14.5819C19.7904 12.6644 18.3913 11.1099 16.6654 11.1099H16.544C16.0948 11.1099 15.8442 11.7773 16.0751 12.2054C16.1697 12.3807 16.3367 12.4987 16.5207 12.4987H16.6654C17.7009 12.4987 18.5404 13.4314 18.5404 14.5819C18.5404 15.7324 17.7009 16.6651 16.6654 16.6651H16.5207C16.3367 16.6651 16.1697 16.7831 16.0751 16.9584Z" fill="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M9.9987 3.70312C8.27281 3.70312 6.8737 5.25757 6.8737 7.17507C6.8737 9.09258 8.27281 10.647 9.9987 10.647C11.7246 10.647 13.1237 9.09258 13.1237 7.17507C13.1237 5.25757 11.7246 3.70312 9.9987 3.70312ZM8.1237 7.17507C8.1237 6.02457 8.96316 5.0919 9.9987 5.0919C11.0342 5.0919 11.8737 6.02457 11.8737 7.17507C11.8737 8.32558 11.0342 9.25824 9.9987 9.25824C8.96316 9.25824 8.1237 8.32558 8.1237 7.17507Z" stroke="currentColor"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.4987 12.0358C5.77281 12.0358 4.3737 13.5902 4.3737 15.5077C4.3737 17.4253 5.77281 18.9797 7.4987 18.9797H12.4987C14.2246 18.9797 15.6237 17.4253 15.6237 15.5077C15.6237 13.5902 14.2246 12.0358 12.4987 12.0358H7.4987ZM5.6237 15.5077C5.6237 14.3572 6.46316 13.4246 7.4987 13.4246H12.4987C13.5342 13.4246 14.3737 14.3572 14.3737 15.5077C14.3737 16.6583 13.5342 17.5909 12.4987 17.5909H7.4987C6.46316 17.5909 5.6237 16.6583 5.6237 15.5077Z" stroke="currentColor"/>
<path d="M6.45882 9.61808C6.32738 9.38348 6.08075 9.25824 5.83203 9.25824C4.7965 9.25824 3.95703 8.32558 3.95703 7.17507C3.95703 6.02457 4.7965 5.0919 5.83203 5.0919C6.08075 5.0919 6.32738 4.96666 6.45882 4.73207C6.46463 4.72169 6.47048 4.71135 6.47636 4.70102C6.6952 4.31725 6.58432 3.77386 6.17787 3.72414C6.06431 3.71025 5.94892 3.70312 5.83203 3.70312C4.10614 3.70312 2.70703 5.25757 2.70703 7.17507C2.70703 9.09258 4.10614 10.647 5.83203 10.647C5.94892 10.647 6.06431 10.6399 6.17787 10.626C6.58432 10.5763 6.6952 10.0329 6.47636 9.64912C6.47048 9.6388 6.46463 9.62845 6.45882 9.61808Z" stroke="currentColor"/>
<path d="M3.92227 16.9584C3.82767 16.7831 3.66069 16.6651 3.47669 16.6651H3.33203C2.2965 16.6651 1.45703 15.7324 1.45703 14.5819C1.45703 13.4314 2.2965 12.4987 3.33203 12.4987H3.47669C3.66069 12.4987 3.82767 12.3807 3.92227 12.2054C4.15319 11.7773 3.9026 11.1099 3.45344 11.1099H3.33203C1.60614 11.1099 0.207031 12.6644 0.207031 14.5819C0.207031 16.4994 1.60614 18.0538 3.33203 18.0538H3.45344C3.9026 18.0538 4.15319 17.3865 3.92227 16.9584Z" stroke="currentColor"/>
<path d="M13.521 9.64912C13.3022 10.0329 13.4131 10.5763 13.8195 10.626C13.9331 10.6399 14.0485 10.647 14.1654 10.647C15.8913 10.647 17.2904 9.09258 17.2904 7.17507C17.2904 5.25757 15.8913 3.70312 14.1654 3.70312C14.0485 3.70312 13.9331 3.71026 13.8195 3.72414C13.4131 3.77386 13.3022 4.31725 13.521 4.70102C13.5269 4.71134 13.5328 4.72169 13.5386 4.73207C13.67 4.96666 13.9166 5.0919 14.1654 5.0919C15.2009 5.0919 16.0404 6.02457 16.0404 7.17507C16.0404 8.32558 15.2009 9.25824 14.1654 9.25824C13.9166 9.25824 13.67 9.38348 13.5386 9.61808C13.5328 9.62845 13.5269 9.6388 13.521 9.64912Z" stroke="currentColor"/>
<path d="M16.0751 16.9584C15.8442 17.3865 16.0948 18.0538 16.544 18.0538H16.6654C18.3913 18.0538 19.7904 16.4994 19.7904 14.5819C19.7904 12.6644 18.3913 11.1099 16.6654 11.1099H16.544C16.0948 11.1099 15.8442 11.7773 16.0751 12.2054C16.1697 12.3807 16.3367 12.4987 16.5207 12.4987H16.6654C17.7009 12.4987 18.5404 13.4314 18.5404 14.5819C18.5404 15.7324 17.7009 16.6651 16.6654 16.6651H16.5207C16.3367 16.6651 16.1697 16.7831 16.0751 16.9584Z" stroke="currentColor"/>
</svg>
`,

		insightsIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M16.6643 11.6685C17.5846 11.6685 18.3306 10.9225 18.3306 10.0022C18.3306 9.08195 17.5846 8.33594 16.6643 8.33594C15.7441 8.33594 14.998 9.08195 14.998 10.0022C14.998 10.9225 15.7441 11.6685 16.6643 11.6685Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16.6643 5.00442C17.5846 5.00442 18.3306 4.25841 18.3306 3.33815C18.3306 2.41789 17.5846 1.67188 16.6643 1.67188C15.7441 1.67188 14.998 2.41789 14.998 3.33815C14.998 4.25841 15.7441 5.00442 16.6643 5.00442Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16.6643 18.3247C17.5846 18.3247 18.3306 17.5787 18.3306 16.6585C18.3306 15.7382 17.5846 14.9922 16.6643 14.9922C15.7441 14.9922 14.998 15.7382 14.998 16.6585C14.998 17.5787 15.7441 18.3247 16.6643 18.3247Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3.33229 11.6685C4.25255 11.6685 4.99856 10.9225 4.99856 10.0022C4.99856 9.08195 4.25255 8.33594 3.33229 8.33594C2.41203 8.33594 1.66602 9.08195 1.66602 10.0022C1.66602 10.9225 2.41203 11.6685 3.33229 11.6685Z" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <g opacity="0.4">
    <path d="M4.99805 9.99219H14.9957" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14.996 3.32812H11.6635C9.9972 3.32812 9.16406 4.16126 9.16406 5.82754V14.1589C9.16406 15.8252 9.9972 16.6583 11.6635 16.6583H14.996" stroke="currentColor" stroke-width="1.12383" stroke-linecap="round" stroke-linejoin="round"/>
    </g>
    </svg>`,

		settingsIcon: `<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10.0005 18.8557C9.44219 18.8557 8.87552 18.7307 8.43385 18.4724L3.85052 15.8307C1.98385 14.5724 1.86719 14.3807 1.86719 12.4057V7.58906C1.86719 5.61406 1.97552 5.4224 3.80885 4.18073L8.42552 1.51406C9.30052 1.00573 10.6755 1.00573 11.5505 1.51406L16.1505 4.16406C18.0172 5.4224 18.1339 5.61406 18.1339 7.58906V12.3974C18.1339 14.3724 18.0255 14.5641 16.1922 15.8057L11.5755 18.4724C11.1255 18.7307 10.5589 18.8557 10.0005 18.8557ZM10.0005 2.38906C9.65052 2.38906 9.30885 2.45573 9.06719 2.5974L4.48385 5.2474C3.12552 6.16406 3.12552 6.16406 3.12552 7.58906V12.3974C3.12552 13.8224 3.12552 13.8224 4.51719 14.7641L9.06719 17.3891C9.55885 17.6724 10.4505 17.6724 10.9422 17.3891L15.5255 14.7391C16.8755 13.8224 16.8755 13.8224 16.8755 12.3974V7.58906C16.8755 6.16406 16.8755 6.16406 15.4839 5.2224L10.9339 2.5974C10.6922 2.45573 10.3505 2.38906 10.0005 2.38906Z" fill="currentColor"/>
<path d="M10 13.125C8.275 13.125 6.875 11.725 6.875 10C6.875 8.275 8.275 6.875 10 6.875C11.725 6.875 13.125 8.275 13.125 10C13.125 11.725 11.725 13.125 10 13.125ZM10 8.125C8.96667 8.125 8.125 8.96667 8.125 10C8.125 11.0333 8.96667 11.875 10 11.875C11.0333 11.875 11.875 11.0333 11.875 10C11.875 8.96667 11.0333 8.125 10 8.125Z" fill="currentColor"/>
</svg>`
	};

	subMenuItems.set([
		{ label: 'Overview', icon: vendorIcons.overviewIcon, nav: '/vendor' },
		{
			label: 'Product/Services',
			icon: vendorIcons.productsIcon,
			nav: '/vendor/products'
		},
		{
			label: 'Collaboration',
			icon: vendorIcons.collabIcon,
			nav: '/vendor/collab'
		},
		{
			label: 'Insights',
			icon: vendorIcons.insightsIcon,
			nav: '/vendor/insights'
		},
		{
			label: 'Settings',
			icon: vendorIcons.settingsIcon,
			nav: '/vendor/settings'
		}
	]);

	let isMobile = false;

	function checkScreenSize() {
		if (browser) {
			isMobile = window.innerWidth < 768;
		}
	}

	onMount(() => {
		checkScreenSize();
		window.addEventListener('resize', checkScreenSize);
		return () => window.removeEventListener('resize', checkScreenSize);
	});

	const themes = {
		default: 'linear-gradient(180deg, #d1e8f5 0%, #EAF2F5 17%, #f4f5f6 35%)'
	};

	let selectedTheme = themes.default;

	function getThemeForRoute(_: string | null): string {
		return themes.default;
	}

	$: path = $page.url.pathname;

	$: if (path.startsWith('/vendor/') || path === '/vendor') {
		selectedTheme = getThemeForRoute(path);

		const currentMenu = get(subMenuItems);
		const active = currentMenu.find((item) => item.nav === path)?.label || 'Overview';

		showSubMenu.set(true);
		activeSubItem.set(active);
	}

	$: activeItem = $activeSubItem;
	$: menuItems = $subMenuItems;
	$: showSubMenuValue = $showSubMenu;

	$: isSubMenuVisible = isMobile ? menuItems.length > 0 : showSubMenuValue;
</script>

<div
	class="relative flex min-h-screen flex-col text-sm font-medium md:flex-row"
	style="background-image: {selectedTheme};"
>
	<div class="relative md:min-w-[117px]">
		<Sidebar background_color="#f4f5f6" />
	</div>

	{#if isSubMenuVisible}
		<div class="relative hidden md:block md:min-w-[250px]">
			<SideMenu items={menuItems} {activeItem} />
		</div>
	{/if}
	<main class="relative mb-[106px] flex min-h-screen w-full flex-col p-3 md:mb-0 md:p-5">
		<div class="bg flex w-full flex-1 flex-col px-3 py-4 md:p-6 lg:p-8">
			{#if isSubMenuVisible && menuItems.length > 0}
				<div class="relative mb-6 md:hidden">
					<SideMenu items={menuItems} {activeItem} />
				</div>
			{/if}
			<slot class="h-full w-full flex-1" />
		</div>
	</main>
</div>

<style>
	.bg {
		background: rgba(255, 255, 255, 0.08);
		box-shadow:
			0px 0px 0px 1px rgba(64, 87, 109, 0.04),
			0px 6px 20px -4px rgba(64, 87, 109, 0.3);
		border-radius: 12px;
	}
</style>
